#!/bin/bash

puid=`id -u`
pgid=`id -g`
if [ $puid -ne @PIPELINE_UID@ -o $pgid -ne @PIPELINE_GID@ ]
then
  echo "This program can only be run by the (@PIPELINE_USER@) user!"
  exit 1
fi

echo "Saving current toolsets as: /usr/tmp/pipeline-toolsets-backup.tgz"
pushd @NODEDIR@
  tar -zcvf /usr/tmp/pipeline-toolsets-backup.tgz toolsets
popd

for ts in @NODEDIR@/toolsets/toolsets/* 
do
  if [ -f $ts ]
  then
    mv $ts $ts.ORIG
    mkdir $ts
    mv $ts.ORIG $ts/Unix
  fi
done

for pkg in @NODEDIR@/toolsets/packages/*
do 
  if [ -d $pkg ]
  then 
    for pv in $pkg/*
    do
      if [ -f $pv ]
      then
        if [ ! -d $pkg/Unix ]
	then 
          mkdir $pkg/Unix
        fi

        mv $pv $pkg/Unix
      fi
    done
  fi
done
